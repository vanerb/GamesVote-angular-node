<app-container>
  <div class="responsive-container">

    <!-- LEFT -->
    <div class="left flex flex-col justify-center items-center w-full h-full">
      <div class="w-full h-full flex items-center justify-center overflow-hidden rounded-[10px]">
        <img *ngIf="game?.cover?.url" [src]="getImage(game?.cover?.url, 't_720p')"
             class="object-contain w-full h-auto rounded-[10px] overflow-hidden shadow-lg">
        <img *ngIf="!game?.cover?.url" [src]="getLocalImage('No_Image_Available.jpg')"
             class="object-contain w-full h-auto rounded-[10px] overflow-hidden shadow-lg">
      </div>
      <div class="text-center text-[36px] font-bold w-full h-[80px] flex justify-center items-center mt-5 gap-2.5">
        <div class="bg-[#363636] rounded-[10px] shadow-lg w-full flex justify-center items-center h-full">
          <img width="32" height="32" [src]="getLocalImage('android-chrome-512x512.png')" class="mr-2.5 rounded-[10px]">
          <span *ngIf="game?.rating">{{ game?.rating?.toFixed(0) }}</span>
          <span *ngIf="!game?.rating">0</span>
        </div>
        <div class="bg-[#363636] rounded-[10px] shadow-lg w-full flex justify-center items-center h-full">
          <img width="32" height="32" [src]="getLocalImage('Games VOte.png')" class="mr-2.5 rounded-[10px]">
          <span>{{ getMediaValue(valorations) }}</span>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="right p-1.5">
      <h1 class="text-center m-0">{{ game?.name }}</h1>

      <!-- Summary -->
      <div *ngIf="game?.summary" class="mt-5 bg-[#363636] p-5 rounded-[10px] shadow-lg">
        <h2 class="m-0 mb-2">Descripci칩n</h2>
        <p class="m-0">{{ game?.summary }}</p>
      </div>

      <!-- Storyline -->
      <div *ngIf="game?.storyline" class="mt-5 bg-[#363636] p-5 rounded-[10px] shadow-lg">
        <h2 class="m-0 mb-2">Sinopsis</h2>
        <p class="m-0">{{ game?.storyline }}</p>
      </div>

      <!-- Genres -->
      <div *ngIf="game?.genres && game.genres.length > 0"
           class="mt-5 bg-[#363636] p-5 rounded-[10px] shadow-lg flex justify-center items-center gap-2.5 flex-wrap">
        <div *ngFor="let genre of game.genres"
             class="px-5 h-9 rounded-[20px] border border-[#363636] flex justify-center items-center">
          <i [ngClass]="'bi bi-'+getGenreIcon(genre.id)" class="text-lg mr-2.5"></i>
          <span>{{ genre?.name }}</span>
        </div>
      </div>

      <!-- Platforms -->
      <div *ngIf="game?.platforms && game.platforms.length > 0"
           class="mt-5 bg-[#363636] p-5 rounded-[10px] shadow-lg flex justify-center items-center gap-2.5 flex-wrap">
        <div *ngFor="let platform of game.platforms"
             class="px-5 h-9 rounded-[20px] border border-[#363636] flex justify-center items-center">
          <i [ngClass]="'bi bi-'+getPlatformIcon(platform.id)" class="text-lg mr-2.5"></i>
          <span>{{ platform?.name }}</span>
        </div>
      </div>

      <!-- Screenshots -->
      <div *ngIf="game?.screenshots" class="mt-5 bg-[#363636] p-5 rounded-[10px] shadow-lg w-[calc(100%)]">
        <h2 class="m-0">Capturas</h2>
        <app-carrousel-images [images]="game.screenshots"></app-carrousel-images>
      </div>

      <!-- Videos -->
      <div *ngIf="game?.videos" class="mt-5 bg-[#363636] p-5 rounded-[10px] shadow-lg w-[calc(100%)]">
        <h2 class="mb-2">Videos</h2>
        <app-carrousel-videos [videos]="game.videos"></app-carrousel-videos>
      </div>

      <!-- Comments -->
      <div class="mt-5 bg-[#363636] p-5 rounded-[10px] shadow-lg">
        <h2 class="mb-2">Comentarios</h2>

        <!-- No valorations -->
        <div *ngIf="myValorations.length === 0 && user"
             class="w-full flex flex-col items-center">

          <div class="w-full flex justify-center items-center flex-wrap mb-2">
            <button *ngFor="let n of [].constructor(10); let i = index" mat-raised-button
                    (click)="setNote(i+1, 'create')"
                    [ngStyle]="createValoration?.value === i+1 ? {'background-color':'rgb(123,31,162)','color':'white','border':'1px solid rgb(123,31,162)','font-weight':'bold'}:{'background-color':'white','color':'rgb(123,31,162)','font-weight':'bold','border':'2px solid rgb(123,31,162)'}"
                    class="p-0 min-h-[42px] min-w-[42px] rounded-[10px] cursor-pointer m-1">
              {{ i + 1 }}
            </button>
          </div>

          <div class="w-full flex justify-center items-end">
            <div class="w-full flex flex-wrap justify-center items-center">
              <div class="w-full">
                <mat-form-field class="w-full mb-[-20px]">
                  <mat-label>Comentario</mat-label>
                  <span matPrefix>
                    <img [src]="'http://localhost:3000/'+cleanUrlImage(user.Images[0].url)"
                         class="w-11 h-11 object-cover rounded-full mx-2.5">
                  </span>
                  <textarea matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize"
                            cdkAutosizeMinRows="1" cdkAutosizeMaxRows="5"
                            [(ngModel)]="createValoration.description"></textarea>
                </mat-form-field>
              </div>
            </div>
            <button mat-raised-button color="primary"
                    class="p-0 min-h-[42px] min-w-[42px] rounded-[10px] ml-2.5"
                    (click)="createMyValoration()">
              <i class="bi bi-send"></i>
            </button>
          </div>
        </div>

        <!-- My valorations -->
        <div *ngIf="myValorations.length > 0">
          <span class="text-center block">Ya has valorado "{{ game.name }}".游뗵游녨</span>
          <div class="w-full">
            <h3>Mi rese침a</h3>

            <!-- Normal mode -->
            <div *ngIf="editMode === false">
              <div *ngFor="let val of myValorations" class="relative flex flex-col mt-2 w-full">
                <!-- Review box -->
                <div class="w-full bg-[rgb(66,66,66)] rounded-[10px] shadow-lg p-2 relative z-1 text-white">
                  <div class="flex items-center">
                    <img [src]="'http://localhost:3000/'+cleanUrlImage(val.User.Images[0].url)"
                         class="w-11 h-11 object-cover rounded-full">
                    <span class="bg-[#7b1fa2] w-[30px] text-center p-2 m-1 rounded-[10px] text-white">
                      {{ val.value }}
                    </span>
                  </div>
                  <div class="flex mt-2 w-full">
                       <span class="text-white break-words w-full">
                          {{ val.description }}
                          </span>
                  </div>
                  <div class="text-right mt-2 text-white">{{ transformDate(val.createdAt) }}</div>
                </div>

                <!-- Buttons -->
                <div class="ml-2 flex justify-end mt-2">
                  <button mat-raised-button color="primary"
                          class="p-0 min-h-[42px] min-w-[42px] rounded-[10px] mb-2 flex justify-center items-center mr-2"
                          (click)="changeEditMode(val.id, val.gameId)">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button mat-raised-button color="warn"
                          class="p-0 min-h-[42px] min-w-[42px] rounded-[10px] flex justify-center items-center"
                          (click)="confirmDeleteId = val.id">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>

                <!-- Delete confirmation overlay -->
                <div *ngIf="confirmDeleteId === val.id"
                     class="absolute top-0 left-0 w-full h-full bg-black bg-opacity-70 rounded-[10px] flex justify-center items-center z-10">
                  <div class="rounded-[10px] p-4 text-center w-[90%] max-w-[350px]">
                    <span>쯉eguro que quieres eliminar la rese침a de "{{ game.name }}"?</span>
                    <span class="block font-bold my-2">Esta acci칩n no se puede deshacer.</span>
                    <div class="flex justify-between mt-2 gap-2">
                      <button mat-stroked-button color="warn"
                              class="p-1 w-full rounded-[8px] text-white"
                              (click)="confirmDeleteId=null">Cancelar
                      </button>
                      <button mat-raised-button color="warn"
                              class="p-1 w-full rounded-[8px] text-white"
                              (click)="deleteReview(val.id)">Aceptar
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Edit mode -->
            <div *ngIf="editMode === true">
              <div *ngFor="let val of myValorations" class="flex flex-col mt-2 w-full">
                <div
                  class="w-full bg-[rgb(66,66,66)] rounded-[10px] shadow-lg p-2 flex flex-col items-center">
                  <div class="flex flex-wrap justify-center items-center w-full gap-2.5 mb-2">
                    <button *ngFor="let n of [].constructor(10); let i = index" mat-raised-button
                            (click)="setNote(i+1,'update')"
                            [ngStyle]="updateValoration?.value===i+1?{'background-color':'rgb(123,31,162)','color':'white','border':'1px solid rgb(123,31,162)','font-weight':'bold'}:{'background-color':'white','color':'rgb(123,31,162)','border':'2px solid rgb(123,31,162)','font-weight':'bold'}"
                            class="p-0 min-h-[42px] min-w-[42px] rounded-[10px] cursor-pointer m-1">{{ i + 1 }}
                    </button>
                  </div>
                  <div class="w-full flex justify-end mb-2">
                    <mat-form-field class="w-full mb-[-20px]">
                      <mat-label>Comentario</mat-label>
                      <span matPrefix>
                        <img [src]="'http://localhost:3000/'+cleanUrlImage(user.Images[0].url)"
                             class="w-11 h-11 object-cover rounded-full mx-2.5">
                      </span>
                      <textarea matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize"
                                cdkAutosizeMinRows="1" cdkAutosizeMaxRows="5"
                                [(ngModel)]="updateValoration.description"></textarea>
                    </mat-form-field>
                  </div>
                  <div class="text-right w-full mt-2 text-white">{{ transformDate(val.createdAt) }}</div>
                </div>

                <!-- Update / Cancel buttons -->
                <div class="ml-2 flex justify-end mt-2">
                  <button mat-raised-button color="primary"
                          class="p-0 min-h-[42px] min-w-[42px] rounded-[10px] mb-2 flex justify-center items-center mr-2"
                          (click)="updateMyValoration()"><i class="bi bi-check-circle"></i></button>
                  <button mat-raised-button color="warn"
                          class="p-0 min-h-[42px] min-w-[42px] rounded-[10px] flex justify-center items-center"
                          (click)="cancelEditMode()"><i class="bi bi-x-circle"></i></button>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- Other valorations -->
        <div class="mt-2 w-full">
          <h3>Otras rese침as</h3>
          <div *ngIf="valorationsWitouthMyValoration.length===0" class="text-center">
            <span>A칰n no hay rese침as...</span>
          </div>
          <div *ngFor="let val of valorationsWitouthMyValoration"
               class="mt-2 bg-white  rounded-[10px] shadow-lg p-2 text-black">
            <div class="flex items-center">
              <img [src]="'http://localhost:3000/'+cleanUrlImage(val.User.Images[0].url)"
                   class="w-11 h-11 object-cover rounded-full">
              <span
                class="bg-[#7b1fa2] md:w-[60px] sm:w-[40px] text-center p-2 m-1 rounded-[10px] text-white">{{ val.value }}</span>
            </div>
            <div class="flex flex-wrap mt-2 break-words">
              <span>{{ val.description }}</span>
            </div>
            <div class="text-right mt-2">{{ transformDate(val.createdAt) }}</div>
          </div>
        </div>

      </div>

    </div>

  </div>
</app-container>
